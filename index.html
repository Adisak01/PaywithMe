<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Planner</title>
  <!-- Bootstrap -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
  <style>
    .container {
      margin-top: 50px;
    }
    .modal-body input {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Monthly Expense Planner</h2>

    <!-- Monthly Income Section -->
    <div class="mb-3">
      <label for="income">Monthly Income:</label>
      <input type="number" id="income" class="form-control" placeholder="Enter Monthly Income">
    </div>

    <!-- Monthly Expense List -->
    <button class="btn btn-primary mb-3" data-toggle="modal" data-target="#addExpenseModal">Add Monthly Expense</button>

    <h4>Monthly Expenses</h4>
    <ul id="expenseList" class="list-group mb-3"></ul>

    <!-- Display Remaining Money -->
    <div class="mb-3">
      <h5>Remaining Money:</h5>
      <p id="remainingMoney">0</p>
      <h5>Money Available per Day:</h5>
      <p id="moneyPerDay">0</p>
    </div>

    <!-- Today's Expense Section -->
    <h4>Today's Expenses</h4>
    <button class="btn btn-info mb-3" data-toggle="modal" data-target="#addTodayExpenseModal">Add Today's Expense</button>

    <!-- Today's Expense List -->
    <ul id="todayExpenseList" class="list-group mb-3"></ul>

    <!-- Today's Expense Modal -->
    <div class="modal fade" id="addTodayExpenseModal" tabindex="-1" role="dialog" aria-labelledby="addTodayExpenseModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addTodayExpenseModalLabel">Add Today's Expense</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <label for="todayExpenseName">Expense Name:</label>
            <input type="text" id="todayExpenseName" class="form-control" placeholder="Expense Name">
            <label for="todayExpenseAmount">Amount:</label>
            <input type="number" id="todayExpenseAmount" class="form-control" placeholder="Amount">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="saveTodayExpense">Save Today's Expense</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Canvas for Graph -->
    <h4>Today's Expense Graph</h4>
    <canvas id="expenseChart" width="400" height="200"></canvas>

    <!-- Summary -->
    <h5>Yearly Summary</h5>
    <p id="yearlySummary">Total Remaining: 0</p>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    let monthlyIncome = 0;
    let monthlyExpenses = [];
    let dailyExpenses = [];
    let yearlyRemaining = 0;
    let dailyBudget = 0;

    // Load data from localStorage
    window.onload = function() {
      const storedIncome = localStorage.getItem('monthlyIncome');
      const storedMonthlyExpenses = localStorage.getItem('monthlyExpenses');
      const storedDailyExpenses = localStorage.getItem('dailyExpenses');

      if (storedIncome) {
        monthlyIncome = parseFloat(storedIncome);
        document.getElementById('income').value = monthlyIncome;
      }
      if (storedMonthlyExpenses) {
        monthlyExpenses = JSON.parse(storedMonthlyExpenses);
        updateExpenseList();
      }
      if (storedDailyExpenses) {
        dailyExpenses = JSON.parse(storedDailyExpenses);
        updateTodayExpenseList();
        updateExpenseChart();
      }
      updateRemainingMoney();
    };

    // Handle Monthly Income input
    document.getElementById('income').addEventListener('input', function() {
      monthlyIncome = parseFloat(this.value);
      localStorage.setItem('monthlyIncome', monthlyIncome); // Save income to localStorage
      updateRemainingMoney();
    });

    // Save Monthly Expense
    document.getElementById('saveExpense').addEventListener('click', function() {
      const expenseName = document.getElementById('expenseName').value;
      const expenseAmount = parseFloat(document.getElementById('expenseAmount').value);

      if(expenseName && expenseAmount) {
        monthlyExpenses.push({ name: expenseName, amount: expenseAmount });
        localStorage.setItem('monthlyExpenses', JSON.stringify(monthlyExpenses)); // Save to localStorage
        updateExpenseList();
        updateRemainingMoney();
        $('#addExpenseModal').modal('hide');
      }
    });

    // Save Today's Expense
    document.getElementById('saveTodayExpense').addEventListener('click', function() {
      const todayExpenseName = document.getElementById('todayExpenseName').value;
      const todayExpenseAmount = parseFloat(document.getElementById('todayExpenseAmount').value);

      // Check if expense exceeds the daily budget
      const isOverLimit = todayExpenseAmount > dailyBudget;

      dailyExpenses.push({ name: todayExpenseName, amount: todayExpenseAmount, overLimit: isOverLimit });
      localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses)); // Save to localStorage
      updateTodayExpenseList();
      updateExpenseChart();
      $('#addTodayExpenseModal').modal('hide');
    });

    // Update Monthly Expenses List
    function updateExpenseList() {
      const expenseList = document.getElementById('expenseList');
      expenseList.innerHTML = '';
      let totalMonthlyExpense = 0;

      monthlyExpenses.forEach((expense, index) => {
        const li = document.createElement('li');
        li.classList.add('list-group-item');
        li.innerHTML = `${expense.name} - ${expense.amount} <button class="btn btn-danger btn-sm float-right" onclick="deleteExpense(${index})">Delete</button>`;
        expenseList.appendChild(li);
        totalMonthlyExpense += expense.amount;
      });

      updateRemainingMoney(totalMonthlyExpense);
    }

    // Delete Monthly Expense
    function deleteExpense(index) {
      monthlyExpenses.splice(index, 1);
      localStorage.setItem('monthlyExpenses', JSON.stringify(monthlyExpenses)); // Save to localStorage
      updateExpenseList();
    }

    // Update Remaining Money and Money Available per Day
    function updateRemainingMoney(totalMonthlyExpense = 0) {
      const totalExpense = monthlyExpenses.reduce((acc, expense) => acc + expense.amount, 0);
      const remainingMoney = monthlyIncome - totalExpense;
      dailyBudget = remainingMoney / 30; // Assuming 30 days in a month
      const moneyPerDay = dailyBudget;

      document.getElementById('remainingMoney').textContent = remainingMoney.toFixed(2);
      document.getElementById('moneyPerDay').textContent = moneyPerDay.toFixed(2);
    }

    // Update Today's Expenses List
    function updateTodayExpenseList() {
      const todayExpenseList = document.getElementById('todayExpenseList');
      todayExpenseList.innerHTML = '';

      dailyExpenses.forEach((expense, index) => {
        const li = document.createElement('li');
        li.classList.add('list-group-item');
        li.innerHTML = `${expense.name} - ${expense.amount} ${expense.overLimit ? "(Over Budget)" : "(OK)"} 
        <button class="btn btn-danger btn-sm float-right" onclick="deleteTodayExpense(${index})">Delete</button>`;
        todayExpenseList.appendChild(li);
      });
    }

    // Delete Today's Expense
    function deleteTodayExpense(index) {
      dailyExpenses.splice(index, 1);
      localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses)); // Save to localStorage
      updateTodayExpenseList();
      updateExpenseChart();
    }

    // Update Expense Chart
    function updateExpenseChart() {
      const ctx = document.getElementById('expenseChart').getContext('2d');
      const labels = dailyExpenses.map(exp => exp.name);
      const data = dailyExpenses.map(exp => exp.amount);

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Daily Expenses',
            data: data,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
          }]
        }
      });
    }
  </script>
</body>
</html>
