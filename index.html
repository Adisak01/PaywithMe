<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Planner</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        .modal-header, .modal-footer { background-color: #f8f9fa; }
        .container { margin-top: 50px; }
        .card { margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center">Monthly Budget Planner</h2>

    <!-- Display Monthly Income -->
    <div class="card">
        <div class="card-body">
            <h5>Monthly Income: <span id="monthlyIncome">0</span> THB</h5>
            <button class="btn btn-primary" data-toggle="modal" data-target="#incomeModal">Edit Income</button>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="card">
        <div class="card-body">
            <h5>Monthly Expenses</h5>
            <button class="btn btn-success" data-toggle="modal" data-target="#expenseModal">Add Expense</button>
            <ul id="expenseList"></ul>
        </div>
    </div>

    <!-- Daily Budget -->
    <div class="card">
        <div class="card-body">
            <h5>Daily Budget: <span id="dailyBudget">0</span> THB</h5>
            <button class="btn btn-info" data-toggle="modal" data-target="#dailyExpenseModal">Add Daily Expense</button>
        </div>
    </div>

    <!-- Canvas for Graph -->
    <div class="card">
        <div class="card-body">
            <h5>Expenses Chart</h5>
            <canvas id="expensesChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Modals -->
    <!-- Income Modal -->
    <div class="modal" id="incomeModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Monthly Income</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="number" id="newIncome" class="form-control" placeholder="Enter Monthly Income">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveIncome">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div class="modal" id="expenseModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Expense</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="expenseName" class="form-control" placeholder="Expense Name">
                    <input type="number" id="expenseAmount" class="form-control mt-2" placeholder="Amount">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveExpense">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Expense Modal -->
    <div class="modal" id="dailyExpenseModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Daily Expense</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="text" id="dailyExpenseName" class="form-control" placeholder="Expense Name">
                    <input type="number" id="dailyExpenseAmount" class="form-control mt-2" placeholder="Amount">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveDailyExpense">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    let monthlyIncome = 0;
    let expenses = [];
    let dailyExpenses = [];
    let dailyLimit = 0;

    // Save and display monthly income
    $('#saveIncome').click(function () {
        monthlyIncome = parseInt($('#newIncome').val()) || 0;
        localStorage.setItem('monthlyIncome', monthlyIncome);
        updateMonthlyIncome();
        $('#incomeModal').modal('hide');
    });

    function updateMonthlyIncome() {
        $('#monthlyIncome').text(monthlyIncome);
        calculateDailyBudget();
        displayExpenses();
    }

    // Load monthly income from localStorage
    $(document).ready(function () {
        if (localStorage.getItem('monthlyIncome')) {
            monthlyIncome = parseInt(localStorage.getItem('monthlyIncome'));
            updateMonthlyIncome();
        }
        if (localStorage.getItem('expenses')) {
            expenses = JSON.parse(localStorage.getItem('expenses'));
            displayExpenses();
        }
        if (localStorage.getItem('dailyExpenses')) {
            dailyExpenses = JSON.parse(localStorage.getItem('dailyExpenses'));
            updateDailyExpenseChart();
        }
    });

    // Add Expense
    $('#saveExpense').click(function () {
        const expenseName = $('#expenseName').val();
        const expenseAmount = parseInt($('#expenseAmount').val());
        if (expenseName && expenseAmount) {
            expenses.push({ name: expenseName, amount: expenseAmount });
            localStorage.setItem('expenses', JSON.stringify(expenses));
            displayExpenses();
            $('#expenseModal').modal('hide');
        }
    });

    function displayExpenses() {
        let expenseListHTML = '';
        let totalExpenses = 0;
        expenses.forEach((expense, index) => {
            expenseListHTML += `<li>${expense.name}: ${expense.amount} THB <button class="btn btn-danger btn-sm" onclick="deleteExpense(${index})">Delete</button></li>`;
            totalExpenses += expense.amount;
        });
        $('#expenseList').html(expenseListHTML);
        localStorage.setItem('totalExpenses', totalExpenses);
        calculateDailyBudget();
    }

    function deleteExpense(index) {
        expenses.splice(index, 1);
        localStorage.setItem('expenses', JSON.stringify(expenses));
        displayExpenses();
    }

    // Calculate Daily Budget
    function calculateDailyBudget() {
        const totalExpenses = parseInt(localStorage.getItem('totalExpenses')) || 0;
        const remaining = monthlyIncome - totalExpenses;
        dailyLimit = remaining / 30;
        $('#dailyBudget').text(dailyLimit.toFixed(2));
    }

    // Daily Expenses Logic
    $('#saveDailyExpense').click(function () {
        const expenseName = $('#dailyExpenseName').val();
        const expenseAmount = parseInt($('#dailyExpenseAmount').val());
        if (expenseName && expenseAmount) {
            const status = expenseAmount > dailyLimit ? 'Over Budget' : 'OK';
            dailyExpenses.push({ name: expenseName, amount: expenseAmount, status: status });
            localStorage.setItem('dailyExpenses', JSON.stringify(dailyExpenses));
            updateDailyExpenseChart();
            $('#dailyExpenseModal').modal('hide');
        }
    });

    function updateDailyExpenseChart() {
        const ctx = document.getElementById('expensesChart').getContext('2d');
        const dates = [];
        const amounts = [];
        dailyExpenses.forEach((expense) => {
            dates.push(expense.name);
            amounts.push(expense.amount);
        });

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Daily Expenses',
                    data: amounts,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>
